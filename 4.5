fun main() = readlnOrNull()
    ?.trim()
    ?.split(";")
    ?.mapNotNull { line ->
        val parts = line.split(" ").map { it.trim() }
        if (parts.size < 3) null
        else {
            val grades = parts.drop(2).mapNotNull { it.toIntOrNull()?.takeIf { g -> g in 1..5 } }
            if (grades.isEmpty()) null else Triple(parts[0], parts[1], grades)
        }
    }
    ?.map { Triple(it.first, it.second, it.third.maxOrNull()!! - it.third.minOrNull()!!) }
    ?.sortedWith(compareByDescending<Triple<String, String, Int>> { it.third }
        .thenBy { it.first }
        .thenBy { it.second })
    ?.let { list ->
        if (list.size < 3) emptyList()
        else {
            val minDiff = list.take(3).last().third
            list.filter { it.third >= minDiff }
        }
    }
    ?.forEach { (last, first, diff) -> println("$last $first: $diff") }
    ?: println("Некорректный ввод")
